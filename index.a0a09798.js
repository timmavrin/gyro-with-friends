let t,e;const a=(t,e)=>{let a=document.createElement(t);return Object.assign(a,e),a};class i{constructor(){this._isCalibrating=!1,this._hasPermission=!1,this.isCalibrating=()=>this._isCalibrating,this.betaPercent=0,this.gammaPercent=0,this.beta=0,this.betaOffset=0,this.betaMax=45,this.gamma=0,this.gammaOffset=0,this.gammaMax=45,this.calibrateCenter(),window.addEventListener("deviceorientation",()=>this._hasPermission=!0,{once:!0})}[Symbol.dispose](){window.removeEventListener("deviceorientation",this.listenToOrientation.bind(this),!0)}listen(){window.removeEventListener("deviceorientation",this.listenToOrientation.bind(this),!0),window.addEventListener("deviceorientation",this.listenToOrientation.bind(this),!0)}listenToOrientation(t){t.beta&&t.gamma&&(this.beta=t.beta-this.betaOffset,this.beta>180?this.beta=-180-this.beta:this.beta<-180&&(this.beta=-(180-this.beta)),this.gamma=t.gamma-this.gammaOffset,this.gamma>90?this.gamma=-90-this.gamma:this.gamma<-90&&(this.gamma=-(90-this.gamma)),this.betaPercent=0,this.beta<0?this.betaPercent=Math.max(-this.betaMax,this.beta)/this.betaMax:this.beta>0&&(this.betaPercent=Math.min(this.betaMax,this.beta)/this.betaMax),this.gammaPercent=0,this.gamma<0?this.gammaPercent=Math.max(-this.gammaMax,this.gamma)/this.gammaMax:this.gamma>0&&(this.gammaPercent=Math.min(this.gammaMax,this.gamma)/this.gammaMax))}calibrateCenter(){window.addEventListener("deviceorientation",t=>{this.betaOffset=t.beta??0,this.gammaOffset=t.gamma??0},{once:!0})}startCalibration(){this._isCalibrating=!0,this.calibrateCenter(),this.betaMax=5,this.gammaMax=5}endCalibration(){this._isCalibrating=!1}calibrateMax(){this.betaMax=Math.max(this.betaMax,Math.abs(this.beta)),this.gammaMax=Math.max(this.gammaMax,Math.abs(this.gamma))}}class s{constructor(){this.squarePixels=1e3,this.isDrawing=!1,this.color="rgb(0,0,0)";let t=a("canvas",{id:"canvas",className:"canvas",width:this.squarePixels,height:this.squarePixels}),e=a("canvas",{id:"pointer-canvas",className:"canvas",width:this.squarePixels,height:this.squarePixels});this.drawCtx=t.getContext("2d"),this.pointerCtx=e.getContext("2d")}registerParent(t){if(t){let e=Math.min(window.innerHeight,window.innerWidth);document.body.style.setProperty("--canvas-size",e+"px"),t.appendChild(this.drawCtx.canvas),t.appendChild(this.pointerCtx.canvas)}}}const n=()=>{t=new i,e=new s;let n=a("div",{id:"draw-page"}),o=a("div",{id:"canvas-container"});e.registerParent(o);let h=a("canvas",{id:"color-canvas"}),l=a("button",{id:"calibrate-button",innerText:"Calibrate"});n.append(o,h,l),document.body.appendChild(n);let d=h.getContext("2d"),m=d?.createLinearGradient(0,200,400,200);m?.addColorStop(0,"red"),m?.addColorStop(.125,"orange"),m?.addColorStop(.25,"yellow"),m?.addColorStop(.375,"green"),m?.addColorStop(.5,"blue"),m?.addColorStop(.625,"purple"),m?.addColorStop(.75,"black"),m?.addColorStop(1,"black"),d.fillStyle=m,d.fillRect(0,0,400,400),h.ontouchstart=t=>{let a=t.touches[0].clientX;if(e){e.isDrawing=!0;let t=d.getImageData(300*a/e.squarePixels,0,1,1).data;e.color=`rgb(${t[0]},${t[1]},${t[2]})`}},h.ontouchmove=t=>{let a=t.touches[0].clientX;if(e){let t=d.getImageData(300*a/e.squarePixels,0,1,1).data;e.color=`rgb(${t[0]},${t[1]},${t[2]})`}},h.ontouchend=()=>{e&&(e.isDrawing=!1)},t.listen(),l.addEventListener("touchstart",e=>{t&&t.startCalibration()}),l.addEventListener("touchend",e=>{t&&t.endCalibration()}),window.requestAnimationFrame(r)},r=()=>{if(t?.isCalibrating())t.calibrateMax();else if(e&&t){let a=e.squarePixels/2,i=e.squarePixels/2,s=a+e.squarePixels*t.gammaPercent/2,n=i+e.squarePixels*t.betaPercent/2;e.isDrawing&&(e.drawCtx.beginPath(),e.drawCtx.arc(s,n,5,0,2*Math.PI,!0),e.drawCtx.fillStyle=e.color,e.drawCtx.fill()),e.pointerCtx.clearRect(0,0,e.squarePixels,e.squarePixels),e.pointerCtx.beginPath(),e.pointerCtx.arc(s,n,20,0,2*Math.PI,!0),e.pointerCtx.strokeStyle="#333",e.pointerCtx.stroke(),e.pointerCtx.beginPath(),e.pointerCtx.arc(s,n,5,0,2*Math.PI,!0),e.pointerCtx.fillStyle="#000",e.pointerCtx.fill()}window.requestAnimationFrame(r)},o=DeviceOrientationEvent,h=()=>{document.querySelector("#title-page")?.remove(),document.body.replaceChildren()},l=()=>{let t=a("div",{id:"title-page"}),e=a("h1",{innerText:"Gyro",className:"title-header"}),i=a("button",{innerText:"Play",className:"big-button",onclick:d});t.append(e,i),document.body.appendChild(t)},d=async()=>{"requestPermission"in o&&"function"==typeof o.requestPermission&&"granted"!==await o.requestPermission()||(h(),n())};window.onload=()=>{l()};
//# sourceMappingURL=index.a0a09798.js.map
