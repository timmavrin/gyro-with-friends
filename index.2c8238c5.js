const e=(e,n)=>{let t=document.createElement(e);return Object.assign(t,n),t},n=new RTCPeerConnection({iceServers:[]}),t=n.createDataChannel("dc");n.addEventListener("connectionstatechange",n=>{console.log("Connection State Change: ",n),document.querySelector("#peer-container")?.append(e("p",{className:"peer",innerText:n.target.connectionState}))}),n.addEventListener("signalingstatechange",e=>{console.log("Signal State Change: ",e)}),n.addEventListener("negotiationneeded",e=>{console.log("Negotiation Needed: ",e)}),t.addEventListener("open",n=>{console.log("Host Opened",n),document.querySelector("#peer-container")?.append(e("p",{innerText:"peer",className:"peer"}))}),t.addEventListener("message",e=>{console.log("Data channel message",e)});const o=new RTCPeerConnection({iceServers:[]});o.createDataChannel("dc").addEventListener("open",e=>{console.log("Join Opened",e)}),o.addEventListener("connectionstatechange",n=>{console.log("Connection State Change: ",n),document.querySelector("#peer-container")?.append(e("p",{className:"peer",innerText:n.target.connectionState}))});const a=()=>{let n=e("div",{id:"lobby-page"}),t=e("h1",{innerText:"Lobby",className:"lobby-header"}),o=e("input",{type:"text",placeholder:"What's the room password?",id:"room-password"}),a=e("button",{className:"big-button",innerText:"Host",id:"host",onclick:i}),r=e("h1",{innerText:"or",className:"or-separator"}),c=e("button",{className:"big-button",innerText:"Join",id:"join",onclick:s});n.append(t,o,a,r,c),document.body.appendChild(n)},r=()=>{let n=document.querySelector("#lobby-page");n?.append(e("h3",{innerText:"Waiting...",className:"status-message"})),document.querySelector("#host")?.remove(),document.querySelector(".or-separator")?.remove(),document.querySelector("#join")?.remove(),n?.append(e("div",{id:"peer-container"}))},c=()=>{let e=document.querySelector("#room-password");if(!e.value)return e.style.border="1px solid red",setTimeout(()=>e.style.border="revert",1e3),[];let n="https://demo.httprelay.io/link/";return[n+`$master$${e.value}`,n+`$slave$${e.value}`]},i=async()=>{r();let[t,o]=c();if(!t||!o)return;let a=e("p",{innerText:"Connecting",className:"peer",id:"#connection"});document.querySelector("#peer-container")?.append(a);let i=await n.createOffer();await n.setLocalDescription(i),fetch(t,{method:"POST",body:JSON.stringify(i)}).then(()=>{fetch(o).then(e=>e.json()).then(async e=>{await n.setRemoteDescription(new RTCSessionDescription(e))})})},s=()=>{r();let[n,t]=c();if(!n||!t)return;let a=e("p",{innerText:"Connecting",className:"peer",id:"#connection"});document.querySelector("#peer-container")?.append(a),fetch(n).then(e=>e.json()).then(async e=>{await o.setRemoteDescription(new RTCSessionDescription(e));let n=await o.createAnswer();await o.setLocalDescription(n),await fetch(t,{method:"POST",body:JSON.stringify(n)})})};window.onload=()=>{a()};
//# sourceMappingURL=index.2c8238c5.js.map
